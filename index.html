<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta de Notas por CPF</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
body {
    font-family: 'Inter', sans-serif;
    background-color: #f3f4f6;
}
</style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-8 space-y-6">

<header class="text-center">
    <h1 class="text-3xl font-bold text-gray-800">Consulta de Desempenho</h1>
    <p class="text-gray-500 mt-2">
        Digite seu CPF para verificar sua situação e média final.
    </p>
</header>

<div class="space-y-4">
    <label class="block text-sm font-medium text-gray-700">
        CPF do usuário (apenas números)
    </label>

    <input
        id="cpfInput"
        type="text"
        maxlength="14"
        placeholder="000.000.000-00"
        oninput="formatCPF(this)"
        class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-indigo-500"
    >

    <button
        onclick="searchStudent()"
        class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition shadow-md">
        Consultar Dados
    </button>
</div>

<div id="resultsArea" class="hidden mt-6">
    <h2 class="text-xl font-semibold mb-3 border-b pb-2">Resultado</h2>
    <div id="resultCard" class="p-5 rounded-xl shadow-xl"></div>
</div>

<div id="messageArea" class="hidden p-4 rounded-lg text-center font-medium"></div>

</div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyg5IQGd3eNA3fTmQr8DXRvaAGfLCCLrj3sBRSG5g6VARrtRKRKs3WKolSG_Q-NayPD/exec';

const cpfInput = document.getElementById('cpfInput');
const resultsArea = document.getElementById('resultsArea');
const resultCard = document.getElementById('resultCard');
const messageArea = document.getElementById('messageArea');

function formatCPF(input) {
    let v = input.value.replace(/\D/g, '').slice(0, 11);
    v = v.replace(/(\d{3})(\d)/, '$1.$2');
    v = v.replace(/(\d{3})(\d)/, '$1.$2');
    v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    input.value = v;
}

async function searchStudent() {
    const cpf = cpfInput.value.replace(/\D/g, '');
    resetUI();

    if (cpf.length !== 11) {
        showMessage('Digite um CPF válido.', 'bg-yellow-100 text-yellow-800 border-yellow-300');
        return;
    }

    try {
        const res = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cpf })
        });

        const data = await res.json();

        if (data.nome) {
            displayResults(data);
        } else {
            showMessage('CPF não encontrado.', 'bg-red-100 text-red-800 border-red-300');
        }
    } catch {
        showMessage('Erro de conexão. Tente novamente.', 'bg-gray-100 text-gray-700 border-gray-300');
    }
}

function displayResults(s) {
    let status = (s.resultado || '').toUpperCase();
    if (status === 'RETIDO') status = 'REPROVADO';
    if (status === 'SUCESSO') status = 'APROVADO';

    const aprovado = status === 'APROVADO';

    resultCard.className = `
        p-5 rounded-xl shadow-xl border-2
        ${aprovado ? 'bg-green-50 border-green-400' : 'bg-red-50 border-red-400'}
    `;

    resultCard.innerHTML = `
        <p class="text-xl font-bold uppercase">${s.nome}</p>
        <div class="mt-3 p-3 rounded-lg text-white ${aprovado ? 'bg-green-600' : 'bg-red-600'}">
            ${aprovado ? '✅' : '❌'} Situação: ${status}
        </div>
        <div class="grid grid-cols-2 gap-4 mt-4 text-gray-700">
            <div>
                <p class="text-sm text-gray-500">CPF</p>
                <p class="font-semibold">${s.cpf}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Média</p>
                <p class="font-semibold">${Number(s.media).toFixed(1)}</p>
            </div>
        </div>
    `;

    resultsArea.classList.remove('hidden');
}

function resetUI() {
    resultsArea.classList.add('hidden');
    messageArea.classList.add('hidden');
}

function showMessage(msg, cls) {
    messageArea.className = `p-4 rounded-lg text-center font-medium border ${cls}`;
    messageArea.innerHTML = msg;
    messageArea.classList.remove('hidden');
}

cpfInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') searchStudent();
});
</script>

</body>
</html>
